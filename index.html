<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover"
    />
    <title>禁令派對｜猜禁令版</title>
    <link rel="stylesheet" href="styles.css" />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"
    ></script>
  </head>
  <body>
    <header class="appbar">
      <div class="app-title">禁令派對</div>
      <div class="app-actions">
        <button id="btnInfo" class="ghost">說明</button>
      </div>
    </header>

    <main id="views">
      <!-- 入場（只輸入名字） -->
      <section id="view-join" class="view active">
        <h2>輸入你的名字即可加入</h2>
        <form id="formJoin" class="col">
          <input id="inpName" maxlength="20" placeholder="你的名字" required />
          <button class="primary" type="submit">加入房間</button>
          <div id="roomHint" class="muted small"></div>
        </form>

        <!-- 若網址沒有 sb/key/room，主持人才需要填 -->
        <details id="hostSetup" class="panel hidden">
          <summary>主持人設定</summary>
          <label
            >房間代碼 <input id="inpRoom" placeholder="例如 HBD15"
          /></label>
          <label
            >SUPABASE_URL
            <input id="inpSbUrl" placeholder="https://xxxx.supabase.co"
          /></label>
          <label
            >ANON_KEY
            <textarea id="inpSbKey" rows="3" placeholder="ey..."></textarea>
          </label>
          <div class="muted small">儲存後可把帶參數的網址分享給大家。</div>
          <button id="btnSaveSetup" class="ghost">儲存設定</button>
        </details>
      </section>

      <!-- 主畫面 -->
      <section id="view-board" class="view">
        <div class="topbar">
          <div class="roomline">房間：<span id="roomCode"></span></div>
          <div class="muted small">在線：<span id="presence"></span></div>
        </div>

        <!-- Host 工具列（僅 Host 可見；CSS 預設隱藏） -->
        <div id="hostBar" class="hostbar">
          <div class="hostbar-left">
            <span class="host-dot"></span> 你是主持人
          </div>
          <div class="hostbar-right">
            <button id="btnRedistribute" class="primary">
              重新分配（全員）
            </button>
            <button id="btnReset" class="danger">重新開始（清房）</button>
            <span class="muted small" id="poolStat"></span>
          </div>
        </div>

        <div id="board" class="grid"></div>

        <!-- 新增禁令（固定在最下方的次要區塊） -->
        <section class="panel add-panel" id="addPanel">
          <div class="col">
            <label class="small muted">新增禁令（任何人都可以提案）</label>
            <div class="row">
              <input
                id="inpNewRule"
                placeholder="例：不能說『乾杯』"
                maxlength="60"
              />
              <button id="btnAddRule" class="ghost">加入禁令池</button>
            </div>
            <div class="muted small" id="addHint"></div>
          </div>
        </section>
      </section>
    </main>

    <!-- 旁觀者看到的違規彈窗（含禁令） -->
    <dialog id="dlgHit" class="hit-modal">
      <div class="hit-card">
        <div class="hit-title">違規！</div>
        <div class="hit-name" id="hitName">Player</div>
        <div class="hit-rule" id="hitRule">禁令內容</div>
        <button id="btnCloseHit" class="primary">關閉</button>
      </div>
    </dialog>

    <!-- 犯規者猜題 -->
    <dialog id="dlgGuess" class="guess-modal">
      <form method="dialog" class="guess-card col">
        <div class="guess-title">你被指出違規！猜猜你的禁令是什麼？</div>
        <input id="inpGuess" placeholder="輸入你的猜測…" maxlength="60" />
        <div class="row">
          <button id="btnSubmitGuess" class="primary" value="default">
            送出猜測
          </button>
          <button id="btnSkipGuess" class="ghost">之後再猜</button>
        </div>
        <div class="muted small">
          （猜對了全體除了你都喝一杯；Host 可替你重抽新禁令）
        </div>
      </form>
    </dialog>

    <!-- 猜題結果（全體提示） -->
    <dialog id="dlgResult" class="result-modal">
      <div class="result-card">
        <div class="result-title" id="resultTitle">猜題結果</div>
        <div class="result-body" id="resultBody">內容</div>
        <button id="btnCloseResult" class="primary">關閉</button>
      </div>
    </dialog>

    <!-- 重開房間通知（所有人） -->
    <dialog id="dlgReset" class="result-modal">
      <div class="result-card">
        <div class="result-title">房主已重新開始</div>
        <div class="result-body">頁面將自動重新載入，請重新加入。</div>
        <button id="btnReloadNow" class="primary">立即重新載入</button>
      </div>
    </dialog>

    <!-- 說明 -->
    <dialog id="dlgInfo" class="panel modal">
      <div class="col">
        <h3>怎麼玩</h3>
        <ol class="small">
          <li>玩家只需輸入名字加入；自己的禁令不會顯示。</li>
          <li>
            誰被點名違規→
            全體閃紅；旁觀者彈窗顯示禁令；犯規者彈出猜題，不顯示禁令。
          </li>
          <li>猜中→ 全體顯示結果；Host 可在該卡按「重抽」替該玩家換新禁令。</li>
          <li>任何人可新增禁令；Host 可全員重新分配。</li>
        </ol>
        <button id="btnCloseInfo" class="primary">關閉</button>
      </div>
    </dialog>

    <footer class="footer">
      <div class="muted small">
        提示：主持人由第一位加入者自動鎖定；之後加入的都是玩家。新增禁令面板在最下方。
      </div>
    </footer>

    <script src="app.js"></script>
  </body>
</html>
